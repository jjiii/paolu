<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	   http://www.springframework.org/schema/beans/spring-beans.xsd
	   http://www.springframework.org/schema/mvc
       http://www.springframework.org/schema/mvc/spring-mvc.xsd
       http://www.springframework.org/schema/aop
	   http://www.springframework.org/schema/aop/spring-aop.xsd
	   http://www.springframework.org/schema/context
	   http://www.springframework.org/schema/context/spring-context.xsd">
	   	
	   	<!-- quartz properties -->
		<!-- <bean id="quartzDbPropertyConfigurer"
			class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
			<property name="locations">
				<list>
					<value>classpath:/properties/quartz_db.properties</value>
				</list>
			</property>
			<property name="fileEncoding" value="utf-8" />
		</bean> -->
		
		<context:component-scan base-package="com.fc.pay.trade.service.notify.impl"/>
		<!-- quartzDataSource -->
		<bean id="quartzDataSource" class="com.alibaba.druid.pool.DruidDataSource"
			init-method="init" destroy-method="close">
			<property name="url" value="${quartz_url}" />
			<property name="username" value="${quartz_username}" />
			<property name="password" value="${quartz_password}" />
			<property name="initialSize"
				value="#{T(java.lang.Integer).parseInt('${quartz_initialSize}')}" />
			<property name="minIdle" value="${quartz_minIdle}" />
			<property name="maxActive" value="${quartz_maxActive}" />
			<property name="maxWait" value="${quartz_maxWait}" />
			<property name="timeBetweenEvictionRunsMillis" value="${quartz_timeBetweenEvictionRunsMillis}" />
			<property name="minEvictableIdleTimeMillis" value="${quartz_minEvictableIdleTimeMillis}" />
			<property name="validationQuery" value="${quartz_validationQuery}" />
			<property name="testWhileIdle" value="${quartz_testWhileIdle}" />
			<property name="testOnBorrow" value="${quartz_testOnBorrow}" />
			<property name="testOnReturn" value="${quartz_testOnReturn}" />
			<property name="poolPreparedStatements" value="${quartz_poolPreparedStatements}" />
			<property name="maxPoolPreparedStatementPerConnectionSize"
				value="${quartz_maxPoolPreparedStatementPerConnectionSize}" />
			<property name="filters" value="${quartz_filters}" />
		</bean>
	   
	   <bean id="quartzScheduler"
		    class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
		    <!-- 自定义的bean注入类，解决job里面无法注入spring的service的问题 -->
		    <property name="jobFactory">
            	<bean class="com.fc.pay.common.spring.SpringBeanJobFactory" />
        	</property>		    
		    <!-- quartz的数据源 -->
		    <property name="dataSource" ref="quartzDataSource" />
		    <!-- quartz的基本配置信息引入 -->
		    <property name="configLocation" value="classpath:/properties/quartz_run.properties"/>		    
			<!-- 调度标识名 -->
		    <property name="schedulerName" value="notify_scheduler" />
		    <!--必须的，QuartzScheduler 延时启动，应用启动完后 QuartzScheduler 再启动 -->
		    <property name="startupDelay" value="5" />
			<!-- 通过applicationContextSchedulerContextKey属性配置spring上下文 -->
		    <property name="applicationContextSchedulerContextKey" value="applicationContextKey" />
		    <!--可选，QuartzScheduler 启动时更新己存在的Job，这样就不用每次修改targetObject后删除qrtz_job_details表对应记录了 -->
		    <property name="overwriteExistingJobs" value="true" />
		    <!-- 设置自动启动 -->
		    <property name="autoStartup" value="true" />
		    <!-- 注册触发器 -->
		    <property  name="triggers">
		        <list>
		            <ref bean="successOrderTrigger" />
		            <!-- <ref bean="successRefundTrigger" /> -->
		            <ref bean="closeOrderTrigger" />
		            <!-- <ref bean="cloesRefundTrigger" /> -->
		        </list>
		    </property>
		    <!-- 注册作业 -->
		    <property name="jobDetails">
		        <list>
		        	<ref bean="successOrderJob" />
		        	<!-- <ref bean="successRefundJob" /> -->
		        	<ref bean="closeOrderJob" />
		        	<!-- <ref bean="cloesRefundJob" /> -->
		        </list>
		    </property>
		</bean>
  		
	    <!--成功订单通知-->
	    <bean id="successOrderJob"  
	        class="org.springframework.scheduling.quartz.JobDetailFactoryBean">  
	       <property name="jobClass" value="com.fc.notify.job.SuccessOrderJob"/>
			<property name="durability" value="true" />	
			<property name="requestsRecovery" value="true" /> 
	    </bean>
	    
	    <!--成功退款通知-->
	    <!-- <bean id="successRefundJob"  
	        class="org.springframework.scheduling.quartz.JobDetailFactoryBean">  
	       <property name="jobClass" value="com.fc.notify.job.SuccessRefundJob"/>
			<property name="durability" value="true" />	
			<property name="requestsRecovery" value="true" /> 
	    </bean> -->
	    
	    <!--关闭订单-->  
	    <bean id="closeOrderJob"
	        class="org.springframework.scheduling.quartz.JobDetailFactoryBean">  
	       <property name="jobClass" value="com.fc.notify.job.CloseOrderJob"/>
			<property name="durability" value="true" />	
			<property name="requestsRecovery" value="true" /> 
	    </bean>
	      
	    <!--关闭退款-->  
	    <!-- <bean id="cloesRefundJob"
	        class="org.springframework.scheduling.quartz.JobDetailFactoryBean">
	       <property name="jobClass" value="com.fc.notify.job.CloesRefundJob"/>
			<property name="durability" value="true" />
			<property name="requestsRecovery" value="true" />
	    </bean> -->
	    
	      
	      
	      
	      
	    
	    
	    
	    
	    <!--成功订单通知触发器-->  
	    <bean id="successOrderTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">  
	        <property name="jobDetail" ref="successOrderJob" />  
	        <property name="cronExpression">  
	            <!-- 每隔5s执行一次 -->
	            <!-- <value>0/10 * * * * ?</value> -->
	            <!-- 每隔5分钟执行一次-->
	            <value>0 0/2 * * * ?</value> 
	        </property>  
	    </bean>
	    
		<!--成功退款通知触发器-->  
	    <!-- <bean id="successRefundTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">  
	        <property name="jobDetail" ref="successRefundJob" />  
	        <property name="cronExpression">  
	            每隔5s执行一次
	            <value>0/5 * * * * ?</value>
	            每隔5分钟执行一次
	            <value>0 0/5 * * * ?</value>
	        </property>  
	    </bean> -->
	    
	    <!--关闭订单触发器-->
	    <bean id="closeOrderTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">  
	        <property name="jobDetail" ref="closeOrderJob" />  
	        <property name="cronExpression">  
	            <!-- 每隔10分钟执行一次 -->
	            <value>0 0/10 * * * ?</value>
	        </property>  
	    </bean>
	    
	    <!--关闭退款触发器-->
	    <!-- <bean id="cloesRefundTrigger" class="org.springframework.scheduling.quartz.CronTriggerFactoryBean">  
	        <property name="jobDetail" ref="cloesRefundJob" />  
	        <property name="cronExpression">  
	            每隔5分钟执行一次
	            <value>0 0/5 * * * ?</value>
	        </property>  
	    </bean> -->
</beans> 